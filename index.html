<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–¢–∞—Ä–æ ‚Äî —Ä–∞—Å–∫–ª–∞–¥</title>
  <style>
    :root{
      --bg:#0b0f1a; --card:#121a2e; --text:#e9eefc; --muted:#aab3cf;
      --accent:#7c5cff; --border:rgba(255,255,255,.10);
      --shadow: 0 12px 28px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 800px at 30% -10%, rgba(124,92,255,.35), transparent 60%),
                  radial-gradient(1000px 700px at 80% 10%, rgba(0,212,255,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:960px; margin:0 auto; padding:18px}
    .top{
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:14px 14px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand{display:flex; flex-direction:column; gap:2px}
    .brand h1{margin:0; font-size:18px; letter-spacing:.2px}
    .brand p{margin:0; color:var(--muted); font-size:13px}
    .btns{display:flex; gap:10px; flex-wrap:wrap}
    button{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease;
      user-select:none;
    }
    button:active{transform: scale(.98)}
    .primary{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(124,92,255,.55));
      border-color: rgba(124,92,255,.55);
    }
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:14px;
    }
    @media (max-width: 820px){ .grid{grid-template-columns:1fr} }
    .slot{
      background: rgba(255,255,255,.04);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
      min-height: 270px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .slot h2{
      margin:0; font-size:14px; color:var(--muted); font-weight:600;
      display:flex; align-items:center; justify-content:space-between;
    }
    .card{
      flex:1;
      border-radius: 16px;
      border:1px dashed rgba(255,255,255,.20);
      background:
        radial-gradient(600px 240px at 30% 20%, rgba(124,92,255,.25), transparent 55%),
        rgba(0,0,0,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
      text-align:center;
      position:relative;
      overflow:hidden;
      cursor:pointer;
    }
    .card.revealed{
      border-style: solid;
      background: rgba(18,26,46,.9);
    }
    .card .hint{color:var(--muted); font-size:13px; line-height:1.35}
    .card .name{font-size:18px; font-weight:700; margin-bottom:6px}
    .card .sub{font-size:13px; color:var(--muted)}
    .tag{
      font-size:12px; color:rgba(255,255,255,.85);
      border:1px solid rgba(255,255,255,.14);
      padding:6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
    }
    .foot{
      margin-top:14px;
      color:var(--muted);
      font-size:12px;
      text-align:center;
      opacity:.9;
    }
    /* modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      background: rgba(0,0,0,.55);
    }
    .modal.open{display:flex}
    .modal .box{
      width:min(720px, 100%);
      background: rgba(18,26,46,.96);
      border:1px solid var(--border);
      border-radius: 20px;
      box-shadow: 0 24px 60px rgba(0,0,0,.5);
      padding:16px 16px 12px;
    }
    .modal .box h3{margin:0 0 6px; font-size:18px}
    .modal .box p{margin:0 0 10px; color:var(--muted); line-height:1.5}
    .modal .row{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>–¢–∞—Ä–æ ¬∑ –†–∞—Å–∫–ª–∞–¥ –Ω–∞ 3 –∫–∞—Ä—Ç—ã</h1>
        <p id="hello">–û—Ç–∫—Ä–æ–π –∫–∞—Ä—Ç—ã –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ —Ç—Ä–∞–∫—Ç–æ–≤–∫—É.</p>
      </div>
      <div class="btns">
        <button id="btnShuffle">üîÆ –ù–æ–≤—ã–π —Ä–∞—Å–∫–ª–∞–¥</button>
        <button id="btnSave" class="primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="btnHistory">üìú –ò—Å—Ç–æ—Ä–∏—è</button>
      </div>
    </div>

    <div class="grid">
      <div class="slot" data-pos="past">
        <h2>–ü—Ä–æ—à–ª–æ–µ <span class="tag">1</span></h2>
        <div class="card" id="card-past">
          <div class="hint">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤—ã—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É</div>
        </div>
      </div>
      <div class="slot" data-pos="present">
        <h2>–ù–∞—Å—Ç–æ—è—â–µ–µ <span class="tag">2</span></h2>
        <div class="card" id="card-present">
          <div class="hint">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤—ã—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É</div>
        </div>
      </div>
      <div class="slot" data-pos="future">
        <h2>–ë—É–¥—É—â–µ–µ <span class="tag">3</span></h2>
        <div class="card" id="card-future">
          <div class="hint">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤—ã—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É</div>
        </div>
      </div>
    </div>

    <div class="foot">–†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ—Ç–æ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–¥—É –∏–∑ 78 –∫–∞—Ä—Ç, –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏, –ø–æ–¥–ø–∏—Å–∫—É, –∏ —Ç.–¥.</div>
  </div>

  <div class="modal" id="modal">
    <div class="box">
      <h3 id="mTitle"></h3>
      <p id="mText"></p>
      <div class="row">
        <button id="mClose" class="primary">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    // Telegram WebApp (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ; –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤–Ω–µ TG ‚Äî —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.ready();
      tg.expand();
      document.documentElement.style.background = tg.themeParams?.bg_color || '';
      const name = tg.initDataUnsafe?.user?.first_name;
      if (name) document.getElementById('hello').textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}. –ù–∞–∂–º–∏ –Ω–∞ –∫–∞—Ä—Ç—ã, —á—Ç–æ–±—ã –≤—ã—Ç—è–Ω—É—Ç—å —Ä–∞—Å–∫–ª–∞–¥.`;
    }

    // –ú–∏–Ω–∏-–Ω–∞–±–æ—Ä (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞). –ü–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏–º –Ω–∞ 78 –∫–∞—Ä—Ç + –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ã–µ.
    const deck = [
      { id: "fool", name: "–®—É—Ç", text: "–ù–æ–≤—ã–π –ø—É—Ç—å, —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å, –≤–µ—Ä–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å. –°–æ–≤–µ—Ç: –Ω–∞—á–Ω–∏ –∏ —É—á–∏—Å—å –ø–æ –¥–æ—Ä–æ–≥–µ." },
      { id: "magician", name: "–ú–∞–≥", text: "–†–µ—Å—É—Ä—Å—ã —É–∂–µ –≤ —Ä—É–∫–∞—Ö. –î–µ–π—Å—Ç–≤—É–π, —Å–æ–±–µ—Ä–∏ —Ñ–æ–∫—É—Å, –ø—Ä–æ—è–≤–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É." },
      { id: "high_priestess", name: "–ñ—Ä–∏—Ü–∞", text: "–ò–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω–∞, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∑–Ω–∞–Ω–∏–µ. –°–æ–≤–µ—Ç: –º–µ–Ω—å—à–µ —à—É–º–∞ ‚Äî –±–æ–ª—å—à–µ —Å–ª—É—à–∞–π —Å–µ–±—è." },
      { id: "empress", name: "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", text: "–†–æ—Å—Ç, –∑–∞–±–æ—Ç–∞, –∏–∑–æ–±–∏–ª–∏–µ, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ. –ü–∏—Ç–∞–π —Ç–æ, —á—Ç–æ —Ö–æ—á–µ—à—å –≤—ã—Ä–∞—Å—Ç–∏—Ç—å." },
      { id: "emperor", name: "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä", text: "–°—Ç—Ä—É–∫—Ç—É—Ä–∞, –ø–æ—Ä—è–¥–æ–∫, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –ù—É–∂–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –∏ –ø–ª–∞–Ω." },
      { id: "lovers", name: "–í–ª—é–±–ª—ë–Ω–Ω—ã–µ", text: "–í—ã–±–æ—Ä, —Å–æ—é–∑, —Ü–µ–Ω–Ω–æ—Å—Ç–∏. –°–≤–µ—Ä—å —Ä–µ—à–µ–Ω–∏–µ —Å–æ —Å–≤–æ–∏–º–∏ –∏—Å—Ç–∏–Ω–Ω—ã–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏." },
      { id: "chariot", name: "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", text: "–î–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä—ë–¥, —Ü–µ–ª—å, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞. –ü–æ–±–µ–¥–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—å –∫—É—Ä—Å–∞." },
      { id: "strength", name: "–°–∏–ª–∞", text: "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º–æ—â—å, –º—è–≥–∫–∞—è –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –°–¥–µ—Ä–∂–∞–Ω–Ω–æ—Å—Ç—å —Å–∏–ª—å–Ω–µ–µ –¥–∞–≤–ª–µ–Ω–∏—è." },
      { id: "hermit", name: "–û—Ç—à–µ–ª—å–Ω–∏–∫", text: "–ü–æ–∏—Å–∫ —Å–º—ã—Å–ª–∞, –ø–∞—É–∑–∞, –º—É–¥—Ä–æ—Å—Ç—å. –ù–∞–π–¥–∏ —Å–≤–æ–π —Å–≤–µ—Ç –∏ –Ω–µ —Å–ø–µ—à–∏." },
      { id: "wheel", name: "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", text: "–ü–æ–≤–æ—Ä–æ—Ç, —Ü–∏–∫–ª—ã, —à–∞–Ω—Å. –ë—É–¥—å –≥–∏–±–∫–∏–º ‚Äî –≤—Ä–µ–º—è –º–µ–Ω—è–µ—Ç—Å—è." },
      { id: "justice", name: "–ü—Ä–∞–≤–æ—Å—É–¥–∏–µ", text: "–ë–∞–ª–∞–Ω—Å, —á–µ—Å—Ç–Ω–æ—Å—Ç—å, –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è. –†–µ—à–∞–π —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ." },
      { id: "death", name: "–°–º–µ—Ä—Ç—å", text: "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–∞–ø–∞. –û—Ç–ø—É—Å—Ç–∏ —Å—Ç–∞—Ä–æ–µ ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–æ–≤–æ–µ." },
    ];

    const state = {
      remaining: [],
      draw: { past: null, present: null, future: null },
    };

    const els = {
      past: document.getElementById("card-past"),
      present: document.getElementById("card-present"),
      future: document.getElementById("card-future"),
      btnShuffle: document.getElementById("btnShuffle"),
      btnSave: document.getElementById("btnSave"),
      btnHistory: document.getElementById("btnHistory"),
      modal: document.getElementById("modal"),
      mTitle: document.getElementById("mTitle"),
      mText: document.getElementById("mText"),
      mClose: document.getElementById("mClose"),
    };

    function shuffle(arr){
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function resetReading(){
      state.remaining = shuffle([...deck]);
      state.draw = { past: null, present: null, future: null };
      for (const k of ["past","present","future"]) renderCard(k);
    }

    function pickCard(){
      if (state.remaining.length === 0) state.remaining = shuffle([...deck]);
      return state.remaining.pop();
    }

    function renderCard(pos){
      const el = els[pos];
      const c = state.draw[pos];
      el.classList.toggle("revealed", !!c);
      el.innerHTML = c
        ? `<div>
             <div class="name">${c.name}</div>
             <div class="sub">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ç—Ä–∞–∫—Ç–æ–≤–∫—É</div>
           </div>`
        : `<div class="hint">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤—ã—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É</div>`;
    }

    function openModal(card, pos){
      els.mTitle.textContent = `${card.name} ¬∑ ${labelPos(pos)}`;
      els.mText.textContent = card.text;
      els.modal.classList.add("open");
      if (tg) tg.HapticFeedback?.impactOccurred?.("light");
    }

    function closeModal(){
      els.modal.classList.remove("open");
    }

    function labelPos(pos){
      return pos === "past" ? "–ü—Ä–æ—à–ª–æ–µ" : pos === "present" ? "–ù–∞—Å—Ç–æ—è—â–µ–µ" : "–ë—É–¥—É—â–µ–µ";
    }

    function onCardClick(pos){
      if (!state.draw[pos]) {
        state.draw[pos] = pickCard();
        renderCard(pos);
        if (tg) tg.HapticFeedback?.selectionChanged?.();
      } else {
        openModal(state.draw[pos], pos);
      }
    }

    function allDrawn(){
      return state.draw.past && state.draw.present && state.draw.future;
    }

    function saveToHistory(){
      if (!allDrawn()) {
        alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã—Ç—è–Ω–∏ –≤—Å–µ 3 –∫–∞—Ä—Ç—ã.");
        return;
      }
      const item = {
        at: new Date().toISOString(),
        draw: state.draw,
      };
      const key = "tarot_history_v1";
      const list = JSON.parse(localStorage.getItem(key) || "[]");
      list.unshift(item);
      localStorage.setItem(key, JSON.stringify(list.slice(0, 50)));
      if (tg) tg.showPopup?.({ title: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ", message: "–†–∞—Å–∫–ª–∞–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é.", buttons: [{type:"ok"}] });
      else alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∏—Å—Ç–æ—Ä–∏—é.");
    }

    function showHistory(){
      const key = "tarot_history_v1";
      const list = JSON.parse(localStorage.getItem(key) || "[]");
      if (!list.length) return alert("–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞—è.");
      const lines = list.slice(0, 10).map((it, idx) => {
        const d = new Date(it.at);
        const s = `${idx+1}) ${d.toLocaleString()} ‚Äî ${it.draw.past.name} / ${it.draw.present.name} / ${it.draw.future.name}`;
        return s;
      }).join("\n");
      alert(lines);
    }

    // handlers
    els.past.addEventListener("click", () => onCardClick("past"));
    els.present.addEventListener("click", () => onCardClick("present"));
    els.future.addEventListener("click", () => onCardClick("future"));
    els.btnShuffle.addEventListener("click", resetReading);
    els.btnSave.addEventListener("click", saveToHistory);
    els.btnHistory.addEventListener("click", showHistory);
    els.mClose.addEventListener("click", closeModal);
    els.modal.addEventListener("click", (e) => { if (e.target === els.modal) closeModal(); });

    resetReading();
  </script>

  <!-- Telegram WebApp SDK (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –ª—É—á—à–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –¥–ª—è theme/expand/haptics) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</body>
</html>
